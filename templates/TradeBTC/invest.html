{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no" />
    <title>Đăng kí</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="{% static 'style/app.css'%}" />
    <link rel="stylesheet" href="{% static 'style/info.css'%}" />
    <link rel="stylesheet" href="{% static 'style/invest.css'%}" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />
    <script
      src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
      integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js"
      integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"
      integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <div id="info" class="info invest">
      <div class="header">
        <i class="fa-solid fa-list"></i> <strong>USDT</strong>
        <span class="red green">LONG,DOUBLE</span>
        <span class="chart">
          <i class="fa-solid fa-chart-simple"></i>
        </span>
      </div>
      <div class="content">
        <div class="first-box">
            <div id="part1" class="part1">
              <form method="post" id="task-form">
                {% csrf_token %}
                <input name="type" class="input-short-long" value="" hidden
                 id="type" />
                <div class="item header-part1">Giao dịch thông thường</div>
                  <div class="list-item">
                    <div class="item" value="0">
                      <div class="name">long</div>
                      <div class="price">1.96</div>
                    </div>
                    <div class="item" value="1">
                      <div class="name">short</div>
                      <div class="price">1.96</div>
                    </div>
                    <div class="item">
                      <div class="name">long</div>
                      <div class="price">1.96</div>
                    </div>
                    <div class="item">
                      <div class="name">long</div>
                      <div class="price">1.96</div>
                    </div>
                    <div class="item">
                      <div class="name">long</div>
                      <div class="price">1.96</div>
                    </div>
                    <div class="item">
                      <div class="name">long</div>
                      <div class="price">1.96</div>
                    </div>
                    <div class="item">
                      <div class="name">long</div>
                      <div class="price">1.96</div>
                    </div>
                    <div class="item">
                      <div class="name">long</div>
                      <div class="price">1.96</div>
                    </div>
                    <div class="item">
                      <div class="name">long</div>
                      <div class="price">1.96</div>
                    </div>
                    <div class="item">
                      <div class="name">long</div>
                      <div class="price">1.96</div>
                    </div>
                    <div class="item">
                      <div class="name">long</div>
                      <div class="price">1.96</div>
                    </div>
                  </div>
                  <div class="transaction">
                    <div class="available">
                      <p>Có sẵn</p>
                      <p>{{user.wallet}} USDT</p>
                    </div>
                      <div class="input-number">
                        <input class="input-search" name="value" id="value" type="number" placeholder="Nhập số tiền giao dịch" />
                      </div>
                      <button type="submit" class="btn btn-success">Mua ngay</button>
                  </div>
                </div>
              </form>
            </div>
          <div id="part2" class="part2">
            <div class="item header-part2">
              <span>Kết quả</span>
              <span id="phase" style="float: right" value="{{phase.create_at}}"> {{phase.create_at}}Phase </span>
            </div>
            <div class="list-item">
              <div class="item first-item">
                <i class="fa-solid fa-pause"></i> 2:59
              </div>
              <div class="item">
                <div class="left">
                  <span class="red green"
                    >4 +5 +3 = <span class="total">12</span></span
                  >
                </div>
                <div class="right red w-1">No.5714439</div>
              </div>
              <div class="item">
                <div class="left">
                  <span class="red green"
                    >4 +5 +3 = <span class="total">12</span></span
                  >
                </div>
                <div class="right red w-5">No.5714439</div>
              </div>
              <div class="item">
                <div class="left">
                  <span class="red green"
                    >4 +5 +3 = <span class="total">12</span></span
                  >
                </div>
                <div class="right red w-4">No.5714439</div>
              </div>
              <div class="item">
                <div class="left">
                  <span class="red green"
                    >4 +5 +3 = <span class="total">12</span></span
                  >
                </div>
                <div class="right green red w-2">No.5714439</div>
              </div>
            </div>
            <div class="end-part2">
              <h1 class="total-today">{{trade_all_value}}</h1>
              <p>Khối lượng giao dịch cá nhân hôm nay</p>
              <div class="box"></div>
            </div>
          </div>
        </div>
      </div>
      <div class="content2">
        <ul class="nav nav-tabs" id="myTab" role="tablist">
          <li class="nav-item">
            <a
              class="nav-link active btn"
              id="home-tab"
              data-toggle="tab"
              href="#home"
              role="tab"
              aria-controls="home"
              aria-selected="true"
              >Giao dịch hiện tại</a
            >
          </li>
          <li class="nav-item">
            <a
              class="nav-link btn"
              id="profile-tab"
              data-toggle="tab"
              href="#profile"
              role="tab"
              aria-controls="profile"
              aria-selected="false"
              >Quy tắc giao dịch</a
            >
          </li>
        </ul>
        <div class="tab-content" id="myTabContent">
          <div
            class="tab-pane fade show active"
            id="home"
            role="tabpanel"
            aria-labelledby="home-tab"
          >
            <div class="list-item">
              <div class="item">
                <span style="float: left">
                  <h4>Phase5714444/USTD</h4>
                  <p><i class="fa-solid fa-clock"></i> 2023-05-18T00</p>
                </span>
                <span style="float: right">
                  <h4>246(1599.0)</h4>
                  <p class="total green">1+1+0 = 2(SHORT,DOUBLE)</p>
                </span>
              </div>
              <div class="item">
                <span style="float: left">
                  <h4>Phase5714444/USTD</h4>
                  <p><i class="fa-solid fa-clock"></i> 2023-05-18T00</p>
                </span>
                <span style="float: right">
                  <h4>246(1599.0)</h4>
                  <p class="total green">1+1+0 = 2(SHORT,DOUBLE)</p>
                </span>
              </div>
              <div class="item">
                <span style="float: left">
                  <h4>Phase5714444/USTD</h4>
                  <p><i class="fa-solid fa-clock"></i> 2023-05-18T00</p>
                </span>
                <span style="float: right">
                  <h4>246(1599.0)</h4>
                  <p class="total green">1+1+0 = 2(SHORT,DOUBLE)</p>
                </span>
              </div>
              <div class="item">
                <span style="float: left">
                  <h4>Phase5714444/USTD</h4>
                  <p><i class="fa-solid fa-clock"></i> 2023-05-18T00</p>
                </span>
                <span style="float: right">
                  <h4>246(1599.0)</h4>
                  <p class="total green">1+1+0 = 2(SHORT,DOUBLE)</p>
                </span>
              </div>
            </div>
          </div>
          <div
            class="tab-pane fade"
            id="profile"
            role="tabpanel"
            aria-labelledby="profile-tab"
          >
            Không có quy tắc gì cả
          </div>
        </div>
      </div>
      <div class="footer-info">
        <div class="item">
          <div class="icon"><i class="fa-solid fa-house"></i></div>
          <div class="title">
            <a href={% url 'app:home' %}>
            Trang đầu
            </a>
          </div>
        </div>
        <div class="item active">
          <div class="icon no-active">
            <img src="{% static 'assets/tabbar_mony_n.png'%}" width="24" alt="" />
          </div>
          <div class="icon have-active">
            <img src="{% static 'assets/tabbar_mony_y2.png'%}" width="24" alt="" />
          </div>
          <div class="title">Đầu tư</div>
        </div>
        <div class="item">
          <div class="icon no-active">
            <img src="{% static 'assets/tabbar_msg_n.png'%}" width="24" alt="" srcset="" />
          </div>
          <div class="icon have-active">
            <img src="{% static 'assets/tabbar_msg_y.png'%}" width="24" alt="" srcset="" />
          </div>
          <div class="title">
            <a href={% url 'app:service' %}>
            Dịch vụ khách hàng
            </a>
          </div>
        </div>
        <div class="item">
          <div class="icon"><i class="fa-solid fa-user"></i></div>
          <div class="title">
            <a href={% url 'app:dashboard' %}>
            Cá nhân
            </a>
          </div>
        </div>
      </div>
    </div>
  </body>
  <script>
    /*
    On focus out on input nickname,
    call AJAX get request to check if the nickName
    already exists or not.
    */
    $("#nick_name").change(function () {
        // get the nickname
        var nick_name = $(this).val();
        // GET AJAX request
        $.ajax({
            type: 'GET',
            url: "",
            data: {"nick_name": nick_name}
        })
    })
  </script>
  <script type="text/javascript">
    let url = `ws://${window.location.host}/ws/socket-server/`

    const chatSocket = new WebSocket(url)
    console.log(chatSocket)
    let phaseTime = document.querySelector('#phase').getAttribute('value');
    console.log(phaseTime)

    {% comment %} chatSocket.send(JSON.stringify({
        'message':'helo from client'
    })) {% endcomment %}
    chatSocket.onopen = () => chatSocket.send(JSON.stringify({'message': 'Welcome to the chat. Type below to begin a conversation...' }))

    chatSocket.onmessage = function(e){
        let data = JSON.parse(e.data)
        console.log('Data:', data)

 
        if(data.type === 'chat'){
            let messages = document.getElementById('messages')

            messages.insertAdjacentHTML('beforeend', `<div>
                                    <p>${data.message}</p>
                                </div>`)
        }
    }
        {% comment %} let form = document.getElementById('form')
        form.addEventListener('submit', (e)=> {
            e.preventDefault()
            let message = e.target.message.value 
            chatSocket.send(JSON.stringify({
                'message':message
            }))
            form.reset()
        }) {% endcomment %}

    </script>

    <script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>

    <script type="text/javascript">
      $(document).on('submit', '#task-form', function (e) {
        e.preventDefault()
        $.ajax({
          type: 'POST',
          url: '{% url "app:invest" %}',
          data: {
            value: $('#value').val(),
            type: $('#type').val(),
            csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
          }
        })
        const searchInput = document.querySelector('.input-search')
        searchInput.value = ''
      })
    </script>
    <script>
      const list = document.querySelectorAll(".invest .content .part1 .item");
      let inputValue = document.querySelector(".input-short-long");
      console.log(inputValue)
      let value = null;
      list.forEach(function(element) {
        element.addEventListener('click', function() {
          // Xóa lớp "active" khỏi tất cả các phần tử
          list.forEach(function(el) {
            el.classList.remove('active-selection');
          });
      
          // Thêm lớp "active" vào phần tử được nhấp chuột
          this.classList.add('active-selection');
          value = element.getAttribute('value');
          inputValue.setAttribute('value', value);
        });
      });
    </script>

</html>
